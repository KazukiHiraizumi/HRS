<html>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta charset="utf-8">
<head>
<link rel="stylesheet" type="text/css" href="okn.css">
<style type="text/css" >
</style>
<script src="jquery.js" type="text/javascript"></script>
<script src="wsshare.js" type="text/javascript"></script>
<script src="promise-xhr.js" type="text/javascript"></script>
<script src="fileman.js" type="text/javascript"></script>
</head>
<body>
<div style="background-image:url(pb12-002.jpg);height:75px;">
<h2>Program-2</h2>
<a class="bar" href="home-e.html">&nbsp;HOME&nbsp;</a><br>
</div>
<div id="contents">

<div id="main">
<table border>
<tr><td>NAME<td colspan="2"><input type="text" id="name" style="border:0;background-color:beige" readonly></input></tr>
<tr><td>Temporal Frequency<td><input class="shared" type="text" id="prm_hz"></input>
<td><input type="radio" name="hzuni" value="hz" style="width:10;">Hz</input><br>
<input type="radio" name="hzuni" value="deg" style="width:10;">deg/s</input>
<input type="hidden" id="prm_hzuni"></input></tr>
<tr><td>Spatial Frequency<td><input class="shared" type="text" id="prm_cpd"></in><td>cpd</tr>
<tr><td>Fixing Point Size<td><textarea class="shared" cols="12" rows="12" id="prm_mkcpd"></textarea><td>deg</tr>
<tr><td>Fixing Point Color<td><input class="shared" type="text" id="prm_mkcol"></input><td>0.0~1.0</tr>
<tr><td>Belt width<td><input class="shared" type="text" id="prm_blwid"></input><td>0.0~1.0</tr>
<tr><td>T<sub>1</sub><td><input class="shared" type="text" id="prm_tm1"></input><td>msec</tr>
<tr><td>T<sub>2</sub><td><input class="shared" type="text" id="prm_tm2"></input><td>msec</tr>
<tr><td>T<sub>3</sub><td><input class="shared" type="text" id="prm_tm3"></input><td>msec</tr>
</table>
</div>

<div id="side_left">
<div class="dropdown">
<div><button id="FMload"></button>Load</div>
<div id="FMload_pm" style="margin-left:30px;"></div>
<div><button id="FMsave"></button>Save as</div>
<div id="FMsave_pm" style="margin-left:0;"></div>
<div><button id="FMremove"></button>Remove</div>
<div id="FMremove_pm" style="margin-left:30px;"></div>
</div>
<hr>
<div>Current value
<input id="stat_v1" type="text" style="width:60%;border:1;background-color:beige" readonly>deg</input>
</div>
<hr>
<table width="100%" style="border:0;">
<tr><td width="70%"><button style="width:100%;" class="queue" id="srv_run2">Start</button>
<td width="25%"><svg class="indicator" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 15 15">
<g>
<path d="M13,14H2c-0.5523,0-1-0.4477-1-1V2c0-0.5523,0.4477-1,1-1h11c0.5523,0,1,0.4477,1,1v11C14,13.5523,13.5523,14,13,14z"/>
</g>
</svg>
<tr><td><button  style="width:100%;" class="queue" id="srv_abort">Stop</button><td>
</table>

</div>

<script type="text/javascript">
var ws;  //W2W
var fm;  //File Manager
var stat={'run':0,'wait':0};

$(document).ready(function(){
	ws=new WsShare("ws://"+location.hostname+":5000",function(ws){
		Object.assign(ws,{
			'name':'no_name',
			'prm_hz':10,
			'prm_cpd':'1',
			'prm_mkcpd':10,
			'prm_mkcol':25,
			'prm_blwid':0.1,
			'prm_tm1':0,
			'prm_tm2':0,
			'prm_tm3':1000,
			'prm_hzuni':'hz',
		});
		fm=new FileMan(ws);
		fm['dir']='setting2';
		fm['loaded']=function(){
			console.log('loaded:'+ws.prm_hzuni);
			$('input[name=hzuni]').val([ws.prm_hzuni]);
		}
		var name=localStorage.getItem(fm.dir+'name');
		console.log('name recall:'+name);
		fm.json_load(name,function(data){
			ws.send(data);
			ws.set(data);
			fm.reflect(data);
		});
		ws.send({'srv_abort':true});
		ws['tpc_runlevel']=function(n){
			stat.run=n;
			if(n>0){
				if(stat.wait>0) $('.indicator').css({'animation-name':'steady','animation-duration':'2.0s'});
				else $('.indicator').css({'animation-name':'halt','animation-duration':'1.0s'});
			}
			else $('.indicator').css({'animation-name':'none'});
		}
		ws['tpc_wait']=function(n){
			stat.wait=n;
			if(stat.run>0){
				if(n>0) $('.indicator').css({'animation-name':'steady','animation-duration':'2.0s'});
				else $('.indicator').css({'animation-name':'halt','animation-duration':'1.0s'});
			}
		}
		ws['tpc_mkcpd']=function(n){ $('#stat_v1').val(n);}
	});
	$('#srv_run2').click(function(){
		console.log('name saved:'+ws['name']);
		localStorage.setItem(fm.dir+'name',ws['name']);
	});
	$('.shared').change(function(e){
		var target=$(e.target);
		var id=target.attr('id');
		var sv={};
		if(target.attr('type')=='checkbox') sv[id]=target.prop('checked');
		else sv[id]=target.val();
		ws.send(sv);
	});
	$('.queue').click(function(e){
		var target=$(e.target);
		var sv={};
		sv[target.attr('id')]="click";
		ws.send(sv);
	});
	$('input[name=hzuni]').click(function(){
		var u=ws.prm_hzuni=$('input[name=hzuni]:checked').val();
		$('#prm_hzuni').val(u);
		ws.send({prm_hzuni:u});
	});
});



</script>
</body>
</html>
